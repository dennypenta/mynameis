"use strict";(self.webpackChunkmynameis=self.webpackChunkmynameis||[]).push([[304],{5155:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>r,toc:()=>d});var t=n(5893),i=n(1151);const s={slug:"gopls-08",title:"gopls: how your IDE becomes better every day",authors:["denis"],tags:["software","go"]},a=void 0,r={permalink:"/mynameis/blog/gopls-08",source:"@site/blog/08-gopls/index.mdx",title:"gopls: how your IDE becomes better every day",description:"A few years ago we had 2 editors for Go: jetbrains plugin to IntelijIdea and YOURNAMEIT with a go plugin.",date:"2025-02-15T21:41:35.000Z",formattedDate:"February 15, 2025",tags:[{label:"software",permalink:"/mynameis/blog/tags/software"},{label:"go",permalink:"/mynameis/blog/tags/go"}],readingTime:5.23,hasTruncateMarker:!0,authors:[{name:"Denis",title:"Software Experience Dude",key:"denis"}],frontMatter:{slug:"gopls-08",title:"gopls: how your IDE becomes better every day",authors:["denis"],tags:["software","go"]},unlisted:!1,prevItem:{title:"How Treenq builds workload images",permalink:"/mynameis/blog/container-in-container-09"},nextItem:{title:"Go Dockerfile",permalink:"/mynameis/blog/go-dockerfile"}},l={authorsImageUrls:[void 0]},d=[{value:"LSP",id:"lsp",level:3},{value:"LSP Protocol",id:"lsp-protocol",level:3},{value:"gopls under the hood",id:"gopls-under-the-hood",level:3},{value:"Capabilities",id:"capabilities",level:3},{value:"What about Goland",id:"what-about-goland",level:3},{value:"How to debug gopls",id:"how-to-debug-gopls",level:3},{value:"A few nice words in the end",id:"a-few-nice-words-in-the-end",level:3}];function c(e){const o={a:"a",admonition:"admonition",code:"code",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.p,{children:"A few years ago we had 2 editors for Go: jetbrains plugin to IntelijIdea and YOUR_NAME_IT with a go plugin.\nFirst brought tons of closed source components that eventually became Goland and bunch of open source components used by another editor Go plugin:"}),"\n",(0,t.jsx)(o.p,{children:"It worked for a while, but it has a lot of issues."}),"\n",(0,t.jsxs)(o.ol,{children:["\n",(0,t.jsx)(o.li,{children:"Number one, you install a plugin, it installs a tenish of the others, every version half of the tools are broken and that's very lame dance happened every release."}),"\n",(0,t.jsx)(o.li,{children:"The integration complexity, every editor did its own integration set, some used only part of them, some integrated them one by one."}),"\n",(0,t.jsx)(o.li,{children:'Performance, it\'s not obvious today, but every tool worked once per editor request, it means every click "Go to definition" it has index the code base, find the implementatons or the object locations navigate you.'}),"\n"]}),"\n",(0,t.jsx)(o.p,{children:(0,t.jsx)(o.img,{alt:"tools",src:n(3776).Z+"",width:"1562",height:"1274"})}),"\n",(0,t.jsx)(o.h3,{id:"lsp",children:"LSP"}),"\n",(0,t.jsx)(o.p,{children:"And Microsoft did a next step in creating IDE.\nThey decided it's important to decouple Javascript language support from the the editor.\nSo they created another component for autocompletion, code navigation, refactoring and diagnostic.\nThis component must run outside of editor in order to let many vscode instances to reuse the same indexing and cache.\nThe called it a language server and it made a new standard: LSP, Lanugage Server Protocol."}),"\n",(0,t.jsx)(o.p,{children:(0,t.jsx)(o.a,{href:"https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/",children:"https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/"})}),"\n",(0,t.jsx)(o.p,{children:(0,t.jsx)(o.img,{alt:"gopls",src:n(1243).Z+"",width:"1054",height:"908"})}),"\n",(0,t.jsx)(o.p,{children:"It gives every language team to make a developer experience an editor independant delegating all the main editor capabilities to the LSP implementation."}),"\n",(0,t.jsx)(o.p,{children:"It changes 3 fundamental things in the software history:"}),"\n",(0,t.jsxs)(o.ul,{children:["\n",(0,t.jsx)(o.li,{children:"Language team supports any LSP compatible editor, it gives more editors come to the market like Helix, Zed, NVIM, etc."}),"\n",(0,t.jsx)(o.li,{children:'We finally don\'t need to install a bunch of binaries to make the development experience just "fine"'}),"\n",(0,t.jsx)(o.li,{children:"And a bonus point, it gives a Go team to focus on supporting more complicated use cases like large repos support increasing performance for everyone, so it means everyone can make a dev experience better for everyone."}),"\n"]}),"\n",(0,t.jsx)(o.h3,{id:"lsp-protocol",children:"LSP Protocol"}),"\n",(0,t.jsx)(o.p,{children:"Let's have a look at the protocol breifly.\nIt has a client that drives all the necessary capabilities implemented on button clicks, hover, hotkeys, etc.\nImplementing an LSP client it calls a server to resolve some actions.\nFor instance clicking Go to definition it sends a request with a given editor position where the interface method is described."}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-json",children:'{\n  ...\n  "method": "textDocument/definition",\n  "textDocument": {"uri": "file://location/file.go"},\n  "position": {"line": 42, "character: 3"},\n  ...\n}\n'})}),"\n",(0,t.jsx)(o.p,{children:"And the server contains all the indexed codebase can return a list of locations so editor suggest them to a developer."}),"\n",(0,t.jsx)(o.h3,{id:"gopls-under-the-hood",children:"gopls under the hood"}),"\n",(0,t.jsx)(o.p,{children:"Globally gopls has Cache.\nOpening an editor it creates a new Session to connect to the server.\nOpening a new project in the editor it creates a new Workspace looking for a module, go.work or GOPATH directory.\nIt holds metadata to let gopls know where you actually want to navigate in the code.\nIt uses default build, it also means it ignores build flags if you use them."}),"\n",(0,t.jsxs)(o.admonition,{type:"info",children:[(0,t.jsx)(o.p,{children:"In case you wish to see better dev exprience:"}),(0,t.jsxs)(o.ul,{children:["\n",(0,t.jsx)(o.li,{children:"changes to one module to be reflected in another"}),"\n",(0,t.jsx)(o.li,{children:"optimize memory usage by reducing the number of builds it must track"}),"\n",(0,t.jsx)(o.li,{children:"give gopls information where do you work\nthen use go.work."}),"\n"]})]}),"\n",(0,t.jsx)(o.h3,{id:"capabilities",children:"Capabilities"}),"\n",(0,t.jsxs)(o.p,{children:["All the features list you can find ",(0,t.jsx)(o.a,{href:"https://github.com/golang/tools/blob/master/gopls/doc/features/README.md",children:"here"}),".\nBelow I shortly describe what you could find useful to perform gopls at 100%."]}),"\n",(0,t.jsxs)(o.ul,{children:["\n",(0,t.jsx)(o.li,{children:"General information and a doc string on hovering"}),"\n",(0,t.jsx)(o.li,{children:"Diagnostics: static analysys, compile errors"}),"\n",(0,t.jsx)(o.li,{children:"Completion: how vscode intellisense gives you suggestion or cmp/blink for nvim."}),"\n",(0,t.jsx)(o.li,{children:"Navigation: Go to definition, List references, List implementations, etc."}),"\n",(0,t.jsx)(o.li,{children:"Transformation: format, sort imports, and refactoring as rename, inline, extract, etc."}),"\n"]}),"\n",(0,t.jsx)("img",{src:n(6138).Z}),"\n",(0,t.jsx)(o.h3,{id:"what-about-goland",children:"What about Goland"}),"\n",(0,t.jsx)(o.p,{children:"Goland is the opposite, it provides its capabilities as a closed source software. Lately it supports LSP as well, but they rarely can be compared in the feature set."}),"\n",(0,t.jsx)(o.p,{children:"The main difference we all together can make gopls better, while we never can contribute to Goland."}),"\n",(0,t.jsx)(o.p,{children:'If you found an idea like "I miss this hostkey to make this thing" or "generate that piece" or "discover that place" you probably want to develop another editor plugin.\nIt happened it me either, but apparently it\'s not the best solution.\nIf it\'s purely related to a language you just need to contribute to gopls.'}),"\n",(0,t.jsx)(o.h3,{id:"how-to-debug-gopls",children:"How to debug gopls"}),"\n",(0,t.jsx)(o.p,{children:"Here I describe a practical guide to gopls contribution.\nI skip the issue discussion with your proposal, expected output, how you attach a visual picture and communicate nicely, gerrit user experience so on."}),"\n",(0,t.jsx)(o.p,{children:"All the examples are using vscode, I'm sure vim/emacs nerds have cracked it.\nWe don't use GoLand here because it has a lot of internal tooling for Go that may add misunderstanding whether it's gopls or GoLand magic."}),"\n",(0,t.jsxs)(o.p,{children:["First, let's configure a local debugging setup.\nInside the repo we add a debugging statement for vscode in order to run our forked version of gopls, in a folder ",(0,t.jsx)(o.code,{children:"tools/gopls/"})," we add:"]}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-json",children:'{\n  "version": "0.2.0",\n  "configurations": [\n    {\n      "name": "Run Gopls",\n      "type": "go",\n      "request": "launch",\n      "mode": "auto",\n      "program": "./main.go",\n      "args": ["-port=9000"]\n    }\n  ]\n}\n'})}),"\n",(0,t.jsx)(o.p,{children:"Now you can run your gopls."}),"\n",(0,t.jsx)(o.p,{children:"In another editor instance you add a workspace setting:"}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-json",children:'"go.languageServerFlags": [\n  "-remote=localhost:9000"\n]\n'})}),"\n",(0,t.jsx)(o.p,{children:"So you know how to make a call from your editor to the server and found a place to debug."}),"\n",(0,t.jsx)(o.p,{children:"For example you want to add a quickfix, it's a Code Action to make a Transformation, like implementing an interface or generating a function, etc."}),"\n",(0,t.jsxs)(o.p,{children:["Now guess where to put a breakpoint and call a Code Action from a client, in vscode you need to push ",(0,t.jsx)(o.code,{children:"CMD + ."})," or find your hotkey in the ",(0,t.jsx)(o.a,{href:"https://code.visualstudio.com/docs/editor/refactoring#_code-actions-quick-fixes-and-refactorings",children:"doc"}),"."]}),"\n",(0,t.jsx)(o.h3,{id:"a-few-nice-words-in-the-end",children:"A few nice words in the end"}),"\n",(0,t.jsx)(o.p,{children:"What's really important Go team uses LSP compatible editors, so real dog fooding comes in the room, they experience what the build and introduce the features they miss.\nI know for sure Alan Donovan uses Emacs, at least he said so."}),"\n",(0,t.jsxs)(o.p,{children:["If you are still interested look his ",(0,t.jsx)(o.a,{href:"https://youtu.be/8EsaJC9cn4w",children:"speach"})," how they optimized Gopls last interation."]}),"\n",(0,t.jsx)(o.p,{children:"A really hope it raises awareness across the entire Go community and lights the interest to the tooling, more people contribute better experience everyone would have."})]})}function h(e={}){const{wrapper:o}={...(0,i.a)(),...e.components};return o?(0,t.jsx)(o,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},6138:(e,o,n)=>{n.d(o,{Z:()=>t});const t=n.p+"assets/images/goplsdemo-f2b7502d7c1386c4efaf0e44c287e86a.gif"},1243:(e,o,n)=>{n.d(o,{Z:()=>t});const t=n.p+"assets/images/gopls-16a8ddec9a07138982e1e6d3a9952935.png"},3776:(e,o,n)=>{n.d(o,{Z:()=>t});const t=n.p+"assets/images/tools-97d2c88ea8f2d7e405543e5b641d0e2c.png"},1151:(e,o,n)=>{n.d(o,{Z:()=>r,a:()=>a});var t=n(7294);const i={},s=t.createContext(i);function a(e){const o=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function r(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(s.Provider,{value:o},e.children)}}}]);