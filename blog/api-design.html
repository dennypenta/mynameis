<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">Web API Design: A Simplified Approach | Denny&#x27;s blog</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://dennypenta.github.io/mynameis/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://dennypenta.github.io/mynameis/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://dennypenta.github.io/mynameis/blog/api-design"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Web API Design: A Simplified Approach | Denny&#x27;s blog"><meta data-rh="true" name="description" content="Note: This page won’t teach you how to design an API from scratch, but it will give you insights into how I recently designed one while developing my PaaS."><meta data-rh="true" property="og:description" content="Note: This page won’t teach you how to design an API from scratch, but it will give you insights into how I recently designed one while developing my PaaS."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2024-09-19T20:45:05.000Z"><meta data-rh="true" property="article:tag" content="software"><link data-rh="true" rel="icon" href="/mynameis/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://dennypenta.github.io/mynameis/blog/api-design"><link data-rh="true" rel="alternate" href="https://dennypenta.github.io/mynameis/blog/api-design" hreflang="en"><link data-rh="true" rel="alternate" href="https://dennypenta.github.io/mynameis/blog/api-design" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/mynameis/blog/rss.xml" title="Denny&#39;s blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/mynameis/blog/atom.xml" title="Denny&#39;s blog Atom Feed"><link rel="stylesheet" href="/mynameis/assets/css/styles.255ed7f8.css">
<script src="/mynameis/assets/js/runtime~main.26cb761a.js" defer="defer"></script>
<script src="/mynameis/assets/js/main.e52686ee.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/mynameis/"><b class="navbar__title text--truncate">hi! Im Denis</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/mynameis/blog">Blog</a></div><div class="navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/mynameis/blog/web-sucks">Web in 2026 is a tragedy</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/mynameis/blog/tq-devlog-1">PaaS devlog |#1</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/mynameis/blog/container-in-container-09">How Treenq builds workload images</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/mynameis/blog/gopls-08">gopls: how your IDE becomes better every day</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/mynameis/blog/go-dockerfile">Go Dockerfile</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="https://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Note: This page won’t teach you how to design an API from scratch, but it will give you insights into how I recently designed one while developing my PaaS."><header><h1 class="title_f1Hy" itemprop="headline">Web API Design: A Simplified Approach</h1><div class="container_mt6G margin-vert--md"><time datetime="2024-09-19T20:45:05.000Z" itemprop="datePublished">September 19, 2024</time> · <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><span itemprop="name">Denis</span></div><small class="avatar__subtitle" itemprop="description">Software Experience Dude</small></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p><strong>Note</strong>: This page won’t teach you how to design an API from scratch, but it will give you insights into how I recently designed one while developing my <a href="https://github.com/treenq/treenq" target="_blank" rel="noopener noreferrer">PaaS</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="preface">Preface<a href="#preface" class="hash-link" aria-label="Direct link to Preface" title="Direct link to Preface">​</a></h2>
<p>Feel free to skip to the next section if you want to avoid the backstory.</p>
<p>After working with various communication protocols (e.g., web form-data, REST, JSON-RPC 2.0), I’ve realized that many of them aim to cover a wide range of use cases. This broad focus introduces a lot of complexity:</p>
<ul>
<li>Network implementations require special handling, such as decoding domain-level errors into transport error codes and messages.</li>
<li>Encoding and decoding messages require marshalling domain models into protocol-specific formats.</li>
<li>Protocols like REST involve lengthy discussions about naming conventions and URL structures.</li>
<li>Some protocols, like JSON-RPC, demand custom solutions, such as middleware for handling requests.</li>
</ul>
<p>These factors complicate implementations and slow down team agreements.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-grpc-shift">The gRPC Shift<a href="#the-grpc-shift" class="hash-link" aria-label="Direct link to The gRPC Shift" title="Direct link to The gRPC Shift">​</a></h2>
<p>When I started working with gRPC, it introduced some important improvements:</p>
<ul>
<li>Models are generated automatically.</li>
<li>Service interfaces are provided and generated.</li>
<li>Clients are generated, allowing you to focus on just creating requests.</li>
<li>Error codes are simplified, reducing them from hundreds to around 15 (which is still more than needed, but we’ll get to that).</li>
<li>The error format is predefined, so you don’t have to design it—just reuse <a href="https://cloud.google.com/apis/design/errors" target="_blank" rel="noopener noreferrer">the model</a></li>
</ul>
<p>And I liked. I don&#x27;t know who didn&#x27;t.</p>
<p>I loved it. Most people who use gRPC feel the same.
However, gRPC doesn’t naturally align with web browsers due to its reliance on HTTP/2, often necessitating additional layers to adapt to HTTP/1.1.
Still, browser compatibility remains a common requirement.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="bringing-grpc-ideas-to-the-web">Bringing gRPC Ideas to the Web<a href="#bringing-grpc-ideas-to-the-web" class="hash-link" aria-label="Direct link to Bringing gRPC Ideas to the Web" title="Direct link to Bringing gRPC Ideas to the Web">​</a></h2>
<p>This made me think: what can we adopt from gRPC for web APIs? The most obvious feature is <strong>code generation</strong>.</p>
<p>Swagger attempts client generation but introduces its own challenges:</p>
<ol>
<li>Swagger has too many plugins, requires specific formats, and its &quot;standard&quot; is fragmented. Many web renderers are incompatible with each other. For example, Apiary’s requirements may contradict code generation.</li>
<li>Swagger focuses on defining documentation instead of the API itself, adding complexity.</li>
</ol>
<p>The I discovered <a href="https://trpc.io/docs/quickstart" target="_blank" rel="noopener noreferrer">tRPC</a>, which offered many things I’d been hoping for—network handling as a natural consequence of defining models.
The catch? It’s limited to JavaScript.</p>
<p>So, I decided to design my own API approach.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="my-api-design-principles">My API Design Principles<a href="#my-api-design-principles" class="hash-link" aria-label="Direct link to My API Design Principles" title="Direct link to My API Design Principles">​</a></h2>
<p>Here are the guiding principles I followed:</p>
<ul>
<li>It must be built on top of HTTP to support the web.</li>
<li>No URL queries, forms, or arguments in the path—these overcomplicate things. Most people don’t even know that URL queries are essentially <a href="https://en.wikipedia.org/wiki/Multimap" target="_blank" rel="noopener noreferrer">multimaps</a>, which leads to more bugs.</li>
<li>Every API call uses only POST. The payload is always in the body, and for simplicity, in my case, it’s JSON.</li>
<li>The procedure naming follows the same conventions we use in code. For instance, instead of REST’s <code>/users/{id}/wallet</code>, I use <code>/getUserWallet</code>.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-does-this-achieve">What Does This Achieve?<a href="#what-does-this-achieve" class="hash-link" aria-label="Direct link to What Does This Achieve?" title="Direct link to What Does This Achieve?">​</a></h2>
<ul>
<li>I only define the models I need — no extra complexity.</li>
<li>Optionally, I can add descriptions to make the generated documentation more talkative.</li>
<li>From the defined router, I can generate both the client code and the API specification (including Swagger).</li>
<li>The code generation process is simplified: a single - word URL, consistent HTTP method, and uniform marshalling strategy make everything easy to implement and maintain.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="error-handling">Error Handling<a href="#error-handling" class="hash-link" aria-label="Direct link to Error Handling" title="Direct link to Error Handling">​</a></h2>
<p>Error handling is a crucial part of any API design, and the model needs to be flexible enough to cover a wide range of scenarios.
Based on my experience, a simple yet effective error model looks like this:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">type</span><span class="token plain"> Error </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Code    </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Message </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Meta    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">map</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">any</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><strong>Code</strong>: This holds a unique value that identifies the specific issue.
It helps narrow down the location of the problem in the code and quickly leads developers to the exact line or area where the error occurred. Additionally, it provides clear guidance to users about the expected behavior or how to resolve the issue.</li>
<li><strong>Message</strong>: The message field can serve a dual purpose:<!-- -->
<ol>
<li><strong>UserMessage</strong>: This is a user-friendly message that can be translated into different languages on the server side. It&#x27;s meant to be shown in the user interface to guide the user.</li>
<li><strong>DevMessage</strong>: This contains a technical explanation intended for developers or logs. It explains what went wrong, why it happened, and what actions can be taken to resolve it.
While you could use a single string for both, in complex applications with internationalization (i18n) needs, separating them into two distinct lines would help.</li>
</ol>
</li>
<li><strong>Meta</strong>: This is a flexible map that can contain any additional context or metadata about the error. For example, if you&#x27;re validating a form with multiple fields, the Meta map can list which fields failed validation and why.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-error-response">Example Error Response<a href="#example-error-response" class="hash-link" aria-label="Direct link to Example Error Response" title="Direct link to Example Error Response">​</a></h3>
<p>Here’s an example of how this error model might be used in a real-world scenario. Suppose a user submits a tax form with several invalid fields. The API can return an error response like this:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Code</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;TAX_FORM_INVALID&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Meta</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">map</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">any</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;tax_class&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;expected a number between 1 and 4&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;house_number&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;must be a number&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this example:</p>
<ul>
<li>The <strong>Code</strong> is <code>&quot;TAX_FORM_INVALID&quot;</code>, which indicates a validation failure specific to the tax form.</li>
<li>The <strong>Meta</strong> map provides detailed feedback on specific fields (<code>tax_class</code>, <code>house_number</code>) that need attention, making it easier for the user to correct their input.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="error-handling-in-api-handlers">Error Handling in API Handlers<a href="#error-handling-in-api-handlers" class="hash-link" aria-label="Direct link to Error Handling in API Handlers" title="Direct link to Error Handling in API Handlers">​</a></h3>
<p>In my API, the handler interface is designed to consistently return errors using this model.
This ensures that all errors adhere to a common structure, simplifying error handling on both the client and server side.</p>
<p>For instance, a typical API handler might look like this:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">GetProfile</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">ctx context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token boolean">_</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">GetProfileResponse</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain">Error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Here, instead of returning a plain error, the handler returns a pointer to the *Error type.
This approach ensures that any error returned strictly follows the predefined error format.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-from-my-application">Example from My Application<a href="#example-from-my-application" class="hash-link" aria-label="Direct link to Example from My Application" title="Direct link to Example from My Application">​</a></h3>
<p>Here’s a practical example of how I’ve implemented this in my app:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">package</span><span class="token plain"> domain</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;context&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;github.com/treenq/treenq/pkg/vel&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">type</span><span class="token plain"> GetProfileResponse </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Email    </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">`json:&quot;email&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Username </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">`json:&quot;username&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Name     </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">`json:&quot;name&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">h </span><span class="token operator">*</span><span class="token plain">Handler</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">GetProfile</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">ctx context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token boolean">_</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">GetProfileResponse</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain">vel</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    profile </span><span class="token operator">:=</span><span class="token plain"> h</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">authProfiler</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">GetProfile</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> GetProfileResponse</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Email</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">    profile</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Email</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Username</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> profile</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Username</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">     profile</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this code:</p>
<ul>
<li>The <code>GetProfile</code> function fetches the user profile and returns it as a <code>GetProfileResponse</code>.</li>
<li>The second return value is <code>*Error</code> instead of a generic <code>error</code>, making it clear that the function follows the structured error format.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-use-a-custom-error-type">Why Use a Custom Error Type?<a href="#why-use-a-custom-error-type" class="hash-link" aria-label="Direct link to Why Use a Custom Error Type?" title="Direct link to Why Use a Custom Error Type?">​</a></h2>
<p>By using a custom <code>Error</code> type instead of the standard <code>error</code>, we enforce consistency across the API.
The error itself still implements Go’s built-in <code>error</code> interface, allowing it to work seamlessly with existing Go error-handling patterns.
However, the benefit is that every error now carries additional structured information, like the error code and metadata, making it easier to debug and handle errors programmatically.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="epiloge">Epiloge<a href="#epiloge" class="hash-link" aria-label="Direct link to Epiloge" title="Direct link to Epiloge">​</a></h2>
<p>I ended up building a &quot;framework&quot; in Go on top of net/http that is able to generate clients for any language.</p>
<p>You can check it out <a href="https://github.com/treenq/treenq/blob/main/pkg/vel/router.go" target="_blank" rel="noopener noreferrer">here</a>.</p>
<p>I don’t recommend using it as-is — it’s better to copy and adapt it for your own needs.</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/mynameis/blog/tags/software">software</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/mynameis/blog/unit-test-observability"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Unit test in observability</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/mynameis/blog/tq-devlog-0"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">PaaS devlog |#0</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#preface" class="table-of-contents__link toc-highlight">Preface</a></li><li><a href="#the-grpc-shift" class="table-of-contents__link toc-highlight">The gRPC Shift</a></li><li><a href="#bringing-grpc-ideas-to-the-web" class="table-of-contents__link toc-highlight">Bringing gRPC Ideas to the Web</a></li><li><a href="#my-api-design-principles" class="table-of-contents__link toc-highlight">My API Design Principles</a></li><li><a href="#what-does-this-achieve" class="table-of-contents__link toc-highlight">What Does This Achieve?</a></li><li><a href="#error-handling" class="table-of-contents__link toc-highlight">Error Handling</a><ul><li><a href="#example-error-response" class="table-of-contents__link toc-highlight">Example Error Response</a></li><li><a href="#error-handling-in-api-handlers" class="table-of-contents__link toc-highlight">Error Handling in API Handlers</a></li><li><a href="#example-from-my-application" class="table-of-contents__link toc-highlight">Example from My Application</a></li></ul></li><li><a href="#why-use-a-custom-error-type" class="table-of-contents__link toc-highlight">Why Use a Custom Error Type?</a></li><li><a href="#epiloge" class="table-of-contents__link toc-highlight">Epiloge</a></li></ul></div></div></div></div></div></div>
</body>
</html>